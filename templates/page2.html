<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;400;600&family=Quicksand:wght@300;400;700&family=Tilt+Neon&display=swap" rel="stylesheet">
    <title>Document</title>
</head>
<script src="https://cdn.tailwindcss.com"></script>
<script src="../static/webcam.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<body class="flex justify-content items-center h-screen">
    <div class="container mx-auto">
        <div class="flex min-h-screen flex-col justify-center overflow-hidden bg-white py-6 sm:py-12">
            <div class="mx-auto max-w-4xl rounded-3xl bg-white p-20 text-center shadow-lg">
              <h2 class="text-5xl font-bold leading-tight ">Please look at the camera</h2>
              <p class="mt-5 text-xl leading-8 text-[#445D48]">Elevate your listening experience with our emotion-based music selection.</p>
              <div id="my_photo_booth">
                <div id="my_camera" class="mt-5 mr-1"></div>
                <div id="results" class="mt-5 mr-1 hidden">
                    <!-- Your captured image will appear here... -->
                </div>
                <form>
                    <div id="post_take_buttons">
                      <!-- These buttons are shown after a snapshot is taken -->
                      <input
                        type="button"
                        class="mt-5 w-full bg-transparent hover:bg-[#445D48] cursor-pointer text-[#445D48] font-semibold hover:text-white py-4 px-10 border border-[#445D48] hover:border-transparent rounded-xl tracking-widest"
                        value="ANALYSE"
                        onClick="save_photo()"
                        style="font-weight: bold"
                      />
                    </div>
                  </form>
              </div>
              
            </div>
        </div>
    </div>
</div>
</body>
<script language="JavaScript">
    Webcam.set({
      // live preview size
      width: '100%',
      height: '100%',

      // device capture size
      dest_width: 640,
      dest_height: 480,

      // final cropped size
      crop_width: 480,
      crop_height: 480,

      // format and quality
      image_format: "jpeg",
      jpeg_quality: 90,

      // flip horizontal (mirror mode)
      flip_horiz: true,
    });
    Webcam.attach("#my_camera");
</script>
<script language="JavaScript">
    // preload shutter audio clip
    function preview_snapshot() {
      Webcam.freeze();
    }

    function cancel_preview() {
      Webcam.unfreeze();
      document.getElementById("pre_take_buttons").style.display = "";
      document.getElementById("post_take_buttons").style.display = "none";
    }

    function save_photo() {
      Webcam.snap(function (data_uri) {
        const request = {
          photo_cap: data_uri.split(",")[1],
        };
        console.log(request);
        axios
          .post("http://127.0.0.1:5000" + "/photo_cap", request, {
            "Content-Type": "application/json",
          })
          .then((response) => {
            console.log("response:", response);
          })
          .catch((e) => console.log(e));
        
        axios
        .get("http://127.0.0.1:5000/analyse")
        .then((response)=>{
          console.log("analysis:", response);
        })
        .catch((e) => console.log(e));
        
      });
    }
</script>
</html>